import {
  Mat2,
  Mat2x3,
  Mat2x4,
  Mat3,
  Mat3x2,
  Mat3x4,
  Mat4,
  Mat4x2,
  Mat4x3,
  Vec2,
  Vec3,
  Vec4,
} from "../math/vector";

export type TextureFormat = keyof typeof TEXTURE_FORMAT_TO_WGSL_TYPE_LUT;

export const TEXTURE_FORMAT_TO_WGSL_TYPE_LUT = {
  r8unorm: "f32",
  r8snorm: "f32",
  r8uint: "u32",
  r8sint: "i32",
  r16unorm: "u32",
  r16snorm: "i32",
  r16uint: "u32",
  r16sint: "i32",
  r16float: "f32",
  rg8unorm: "vec2f",
  rg8snorm: "vec2f",
  rg8uint: "vec2u",
  rg8sint: "vec2i",
  r32uint: "u32",
  r32sint: "i32",
  r32float: "f32",
  rg16unorm: "vec2f",
  rg16snorm: "vec2f",
  rg16uint: "vec2u",
  rg16sint: "vec2i",
  rg16float: "vec2f",
  rgba8unorm: "vec4f",
  "rgba8unorm-srgb": "vec4f",
  rgba8snorm: "vec4f",
  rgba8uint: "vec4u",
  rgba8sint: "vec4i",
  bgra8unorm: "vec4f",
  "bgra8unorm-srgb": "vec4f",
  rgb9e5ufloat: "vec4f",
  rgb10a2uint: "vec4u",
  rgb10a2unorm: "vec4f",
  rg11b10ufloat: "vec4f",
  rg32uint: "vec2u",
  rg32sint: "vec2i",
  rg32float: "vec2f",
  rgba16unorm: "vec4u",
  rgba16snorm: "vec4i",
  rgba16uint: "vec4u",
  rgba16sint: "vec4i",
  rgba16float: "vec4f",
  rgba32uint: "vec4u",
  rgba32sint: "vec4i",
  rgba32float: "vec4f",
  stencil8: "u32",
  depth16unorm: "f32",
  depth24plus: "f32",
  "depth24plus-stencil8": "f32",
  depth32float: "f32",
  "depth32float-stencil8": "f32",
  "bc1-rgba-unorm": "vec4f",
  "bc1-rgba-unorm-srgb": "vec4f",
  "bc2-rgba-unorm": "vec4f",
  "bc2-rgba-unorm-srgb": "vec4f",
  "bc3-rgba-unorm": "vec4f",
  "bc3-rgba-unorm-srgb": "vec4f",
  "bc4-r-unorm": "f32",
  "bc4-r-snorm": "f32",
  "bc5-rg-unorm": "vec2f",
  "bc5-rg-snorm": "vec2f",
  "bc6h-rgb-ufloat": "vec3f",
  "bc6h-rgb-float": "vec3f",
  "bc7-rgba-unorm": "vec4f",
  "bc7-rgba-unorm-srgb": "vec4f",
  "etc2-rgb8unorm": "vec3f",
  "etc2-rgb8unorm-srgb": "vec3f",
  "etc2-rgb8a1unorm": "vec4f",
  "etc2-rgb8a1unorm-srgb": "vec4f",
  "etc2-rgba8unorm": "vec4f",
  "etc2-rgba8unorm-srgb": "vec4f",
  "eac-r11unorm": "f32",
  "eac-r11snorm": "f32",
  "eac-rg11unorm": "vec2f",
  "eac-rg11snorm": "vec2f",
  "astc-4x4-unorm": "vec4f",
  "astc-4x4-unorm-srgb": "vec4f",
  "astc-5x4-unorm": "vec4f",
  "astc-5x4-unorm-srgb": "vec4f",
  "astc-5x5-unorm": "vec4f",
  "astc-5x5-unorm-srgb": "vec4f",
  "astc-6x5-unorm": "vec4f",
  "astc-6x5-unorm-srgb": "vec4f",
  "astc-6x6-unorm": "vec4f",
  "astc-6x6-unorm-srgb": "vec4f",
  "astc-8x5-unorm": "vec4f",
  "astc-8x5-unorm-srgb": "vec4f",
  "astc-8x6-unorm": "vec4f",
  "astc-8x6-unorm-srgb": "vec4f",
  "astc-8x8-unorm": "vec4f",
  "astc-8x8-unorm-srgb": "vec4f",
  "astc-10x5-unorm": "vec4f",
  "astc-10x5-unorm-srgb": "vec4f",
  "astc-10x6-unorm": "vec4f",
  "astc-10x6-unorm-srgb": "vec4f",
  "astc-10x8-unorm": "vec4f",
  "astc-10x8-unorm-srgb": "vec4f",
  "astc-10x10-unorm": "vec4f",
  "astc-10x10-unorm-srgb": "vec4f",
  "astc-12x10-unorm": "vec4f",
  "astc-12x10-unorm-srgb": "vec4f",
  "astc-12x12-unorm": "vec4f",
  "astc-12x12-unorm-srgb": "vec4f",
} as const;

export function getCopyFootprintPerTexel(
  fmt: TextureFormat,
  aspect: "all" | "depth-only" | "stencil-only" = "all"
) {
  if (aspect === "stencil-only") {
    if (fmt === "depth24plus-stencil8" || fmt === "depth32float-stencil8") {
      return 1;
    }
  } else if (aspect === "depth-only") {
    if (fmt === "depth32float-stencil8") {
      return 4;
    }
  }

  return TEXEL_BLOCK_COPY_FOOTPRINTS[fmt];
}

export const TEXEL_BLOCK_COPY_FOOTPRINTS = {
  r8unorm: 1,
  r8snorm: 1,
  r8uint: 1,
  r8sint: 1,
  r16unorm: 2,
  r16snorm: 2,
  r16uint: 2,
  r16sint: 2,
  r16float: 2,
  rg8unorm: 2,
  rg8snorm: 2,
  rg8uint: 2,
  rg8sint: 2,
  r32uint: 4,
  r32sint: 4,
  r32float: 4,
  rg16unorm: 4,
  rg16snorm: 4,
  rg16uint: 4,
  rg16sint: 4,
  rg16float: 4,
  rgba8unorm: 4,
  "rgba8unorm-srgb": 4,
  rgba8snorm: 4,
  rgba8uint: 4,
  rgba8sint: 4,
  bgra8unorm: 4,
  "bgra8unorm-srgb": 4,
  rgb9e5ufloat: 4,
  rgb10a2uint: 4,
  rgb10a2unorm: 4,
  rg11b10ufloat: 4,
  rg32uint: 8,
  rg32sint: 8,
  rg32float: 8,
  rgba16unorm: 8,
  rgba16snorm: 8,
  rgba16uint: 8,
  rgba16sint: 8,
  rgba16float: 8,
  rgba32uint: 16,
  rgba32sint: 16,
  rgba32float: 16,
  stencil8: 1,
  depth16unorm: 2,
  depth24plus: undefined,
  "depth24plus-stencil8": undefined,
  depth32float: undefined,
  "depth32float-stencil8": undefined,
  "bc1-rgba-unorm": 8,
  "bc1-rgba-unorm-srgb": 8,
  "bc2-rgba-unorm": 16,
  "bc2-rgba-unorm-srgb": 16,
  "bc3-rgba-unorm": 16,
  "bc3-rgba-unorm-srgb": 16,
  "bc4-r-unorm": 8,
  "bc4-r-snorm": 8,
  "bc5-rg-unorm": 16,
  "bc5-rg-snorm": 16,
  "bc6h-rgb-ufloat": 16,
  "bc6h-rgb-float": 16,
  "bc7-rgba-unorm": 16,
  "bc7-rgba-unorm-srgb": 16,
  "etc2-rgb8unorm": 8,
  "etc2-rgb8unorm-srgb": 8,
  "etc2-rgb8a1unorm": 8,
  "etc2-rgb8a1unorm-srgb": 8,
  "etc2-rgba8unorm": 16,
  "etc2-rgba8unorm-srgb": 16,
  "eac-r11unorm": 8,
  "eac-r11snorm": 8,
  "eac-rg11unorm": 16,
  "eac-rg11snorm": 16,
  "astc-4x4-unorm": 16,
  "astc-4x4-unorm-srgb": 16,
  "astc-5x4-unorm": 16,
  "astc-5x4-unorm-srgb": 16,
  "astc-5x5-unorm": 16,
  "astc-5x5-unorm-srgb": 16,
  "astc-6x5-unorm": 16,
  "astc-6x5-unorm-srgb": 16,
  "astc-6x6-unorm": 16,
  "astc-6x6-unorm-srgb": 16,
  "astc-8x5-unorm": 16,
  "astc-8x5-unorm-srgb": 16,
  "astc-8x6-unorm": 16,
  "astc-8x6-unorm-srgb": 16,
  "astc-8x8-unorm": 16,
  "astc-8x8-unorm-srgb": 16,
  "astc-10x5-unorm": 16,
  "astc-10x5-unorm-srgb": 16,
  "astc-10x6-unorm": 16,
  "astc-10x6-unorm-srgb": 16,
  "astc-10x8-unorm": 16,
  "astc-10x8-unorm-srgb": 16,
  "astc-10x10-unorm": 16,
  "astc-10x10-unorm-srgb": 16,
  "astc-12x10-unorm": 16,
  "astc-12x10-unorm-srgb": 16,
  "astc-12x12-unorm": 16,
  "astc-12x12-unorm-srgb": 16,
} as const;

export const SAMPLER_TYPE_TO_WGSL_TYPE = {
  float: "f32",
  uint: "u32",
  sint: "i32",
  depth: "f32",
} as const;

export const TEXTURE_DIMENSIONALITIES = {
  texture_1d: "1d",
  texture_storage_1d: "1d",
  texture_2d: "2d",
  texture_storage_2d: "2d",
  texture_multisampled_2d: "2d",
  texture_depth_2d: "2d",
  texture_depth_multisampled_2d: "2d",
  texture_2d_array: "2d-array",
  texture_storage_2d_array: "2d-array",
  texture_depth_2d_array: "2d-array",
  texture_3d: "3d",
  texture_storage_3d: "3d",
  texture_cube: "cube",
  texture_depth_cube: "cube",
  texture_cube_array: "cube-array",
  texture_depth_cube_array: "cube-array",
} as const;

export const WGSL_TYPE_SIZES = {
  i32: 4,
  u32: 4,
  f32: 4,
  f16: 2,
  "atomic<u32>": 4,
  "atomic<i32>": 4,
  vec2i: 8,
  vec2u: 8,
  vec2f: 8,
  vec2f16: 4,
  vec3i: 12,
  vec3u: 12,
  vec3f: 12,
  vec3f16: 6,
  vec4i: 16,
  vec4u: 16,
  vec4f: 16,
  vec4f16: 8,
  mat2x2f: 16,
  mat2x2f16: 8,
  mat3x2f: 24,
  mat3x2f16: 12,
  mat4x2f: 32,
  mat4x2f16: 16,
  mat2x3f: 24,
  mat2x3f16: 12,
  mat3x3f: 48,
  mat3x3f16: 24,
  mat4x3f: 64,
  mat4x3f16: 32,
  mat2x4f: 32,
  mat2x4f16: 16,
  mat3x4f: 48,
  mat3x4f16: 24,
  mat4x4f: 64,
  mat4x4f16: 32,
} as const;

export const WGSL_TYPE_ALIGNMENTS = {
  i32: 4,
  u32: 4,
  f32: 4,
  f16: 2,
  "atomic<u32>": 4,
  "atomic<i32>": 4,
  vec2i: 8,
  vec2u: 8,
  vec2f: 8,
  vec2f16: 4,
  vec3i: 16,
  vec3u: 16,
  vec3f: 16,
  vec3f16: 8,
  vec4i: 16,
  vec4u: 16,
  vec4f: 16,
  vec4f16: 8,
  mat2x2f: 8,
  mat2x2f16: 4,
  mat3x2f: 8,
  mat3x2f16: 4,
  mat4x2f: 8,
  mat4x2f16: 4,
  mat2x3f: 16,
  mat2x3f16: 8,
  mat3x3f: 16,
  mat3x3f16: 8,
  mat4x3f: 16,
  mat4x3f16: 8,
  mat2x4f: 16,
  mat2x4f16: 8,
  mat3x4f: 16,
  mat3x4f16: 8,
  mat4x4f: 16,
  mat4x4f16: 8,
} as const;

export const WGSL_TYPE_ELEMENT_COUNTS = {
  i32: 1,
  u32: 1,
  f32: 1,
  f16: 1,
  "atomic<u32>": 1,
  "atomic<i32>": 1,
  vec2i: 2,
  vec2u: 2,
  vec2f: 2,
  vec2f16: 2,
  vec3i: 3,
  vec3u: 3,
  vec3f: 3,
  vec3f16: 3,
  vec4i: 4,
  vec4u: 4,
  vec4f: 4,
  vec4f16: 4,
  mat2x2f: 4,
  mat2x2f16: 4,
  mat3x2f: 6,
  mat3x2f16: 6,
  mat4x2f: 8,
  mat4x2f16: 8,
  mat2x3f: 6,
  mat2x3f16: 6,
  mat3x3f: 9,
  mat3x3f16: 9,
  mat4x3f: 12,
  mat4x3f16: 12,
  mat2x4f: 8,
  mat2x4f16: 8,
  mat3x4f: 12,
  mat3x4f16: 12,
  mat4x4f: 16,
  mat4x4f16: 16,
} as const;

export const WGSL_TYPE_DATATYPES = {
  i32: "i32",
  u32: "u32",
  f32: "f32",
  f16: "f16",
  "atomic<u32>": "u32",
  "atomic<i32>": "i32",
  vec2i: "i32",
  vec2u: "u32",
  vec2f: "f32",
  vec2f16: "f16",
  vec3i: "i32",
  vec3u: "u32",
  vec3f: "f32",
  vec3f16: "f16",
  vec4i: "i32",
  vec4u: "u32",
  vec4f: "f32",
  vec4f16: "f16",
  mat2x2f: "f32",
  mat2x2f16: "f16",
  mat3x2f: "f32",
  mat3x2f16: "f16",
  mat4x2f: "f32",
  mat4x2f16: "f16",
  mat2x3f: "f32",
  mat2x3f16: "f16",
  mat3x3f: "f32",
  mat3x3f16: "f16",
  mat4x3f: "f32",
  mat4x3f16: "f16",
  mat2x4f: "f32",
  mat2x4f16: "f16",
  mat3x4f: "f32",
  mat3x4f16: "f16",
  mat4x4f: "f32",
  mat4x4f16: "f16",
} as const;

export const WGSL_BASE_TYPE_TO_SAMPLER_TYPE = {
  i32: "sint",
  u32: "uint",
  f32: "float",
  f16: "float",
} as const;

export type WgslPrimitiveToType = {
  i32: number;
  u32: number;
  f32: number;
  f16: number;
  "atomic<u32>": number;
  "atomic<i32>": number;
  vec2i: Vec2;
  vec2u: Vec2;
  vec2f: Vec2;
  vec2f16: Vec2;
  vec3i: Vec3;
  vec3u: Vec3;
  vec3f: Vec3;
  vec3f16: Vec3;
  vec4i: Vec4;
  vec4u: Vec4;
  vec4f: Vec4;
  vec4f16: Vec4;
  mat2x2f: Mat2;
  mat2x2f16: Mat2;
  mat3x2f: Mat3x2;
  mat3x2f16: Mat3x2;
  mat4x2f: Mat4x2;
  mat4x2f16: Mat4x2;
  mat2x3f: Mat2x3;
  mat2x3f16: Mat2x3;
  mat3x3f: Mat3;
  mat3x3f16: Mat3;
  mat4x3f: Mat4x3;
  mat4x3f16: Mat4x3;
  mat2x4f: Mat2x4;
  mat2x4f16: Mat2x4;
  mat3x4f: Mat3x4;
  mat3x4f16: Mat3x4;
  mat4x4f: Mat4;
  mat4x4f16: Mat4;
};
